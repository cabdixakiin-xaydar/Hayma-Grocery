<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hayma Grocery - Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 text-gray-900">
    <header class="border-b bg-white sticky top-0 z-10">
      <div class="max-w-6xl mx-auto px-4 py-4 flex items-center gap-4">
        <a href="/frontend/index.html" class="text-xl font-semibold">Hayma Grocery</a>
        <input id="search" class="flex-1 border rounded px-3 py-2" placeholder="Search products..." />
        <a href="/frontend/cart.html" class="px-3 py-2 rounded bg-emerald-600 text-white">Cart</a>
        <a id="auth-link" href="/frontend/login.html" class="px-3 py-2 rounded border">Login</a>
      </div>
    </header>
    <main class="max-w-6xl mx-auto px-4 py-6">
      <div class="flex gap-6">
        <aside class="w-64 hidden md:block">
          <h2 class="font-semibold mb-2">Categories</h2>
          <ul id="category-list" class="space-y-1"></ul>
        </aside>
        <section class="flex-1">
          <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </section>
      </div>
    </main>

    <script type="module">
      import { setAuthLink } from './js/auth.js';
      import { fetchCategories, fetchProducts } from './js/catalog.js';
      import { addToCart } from './js/cart.js';

      setAuthLink(document.getElementById('auth-link'));

      const categoryList = document.getElementById('category-list');
      const productGrid = document.getElementById('product-grid');
      const searchInput = document.getElementById('search');

      let allProducts = [];

      async function load() {
        const [cats, prods] = await Promise.all([
          fetchCategories(),
          fetchProducts(),
        ]);
        allProducts = prods;
        renderCategories(cats);
        renderProducts(prods);
      }

      function renderCategories(categories) {
        categoryList.innerHTML = '';
        categories.forEach((c) => {
          const li = document.createElement('li');
          li.innerHTML = `<button class="w-full text-left px-2 py-1 rounded hover:bg-gray-100" data-slug="${c.slug}">${c.name}</button>`;
          li.querySelector('button').addEventListener('click', () => {
            const filtered = allProducts.filter(p => p.category && p.category.slug === c.slug);
            renderProducts(filtered);
          });
          categoryList.appendChild(li);
        });
      }

      function renderProducts(products) {
        productGrid.innerHTML = '';
        products.forEach((p) => {
          const card = document.createElement('div');
          card.className = 'border rounded-lg bg-white p-4 flex flex-col';
          card.innerHTML = `
            <div class="flex-1">
              <h3 class="font-semibold text-lg">${p.name}</h3>
              <p class="text-sm text-gray-600 line-clamp-3">${p.description || ''}</p>
            </div>
            <div class="mt-3 flex items-center justify-between">
              <span class="font-bold">$${Number(p.price).toFixed(2)}</span>
              <button class="add px-3 py-2 rounded bg-emerald-600 text-white">Add</button>
            </div>
          `;
          card.querySelector('.add').addEventListener('click', async () => {
            await addToCart(p.id, 1);
            alert('Added to cart');
          });
          productGrid.appendChild(card);
        });
      }

      searchInput.addEventListener('input', (e) => {
        const q = e.target.value.toLowerCase();
        const filtered = allProducts.filter(p =>
          p.name.toLowerCase().includes(q) || (p.description || '').toLowerCase().includes(q)
        );
        renderProducts(filtered);
      });

      load();
    </script>
  </body>
  </html>


