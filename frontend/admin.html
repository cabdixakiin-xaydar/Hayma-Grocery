<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin - Hayma Grocery</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 text-gray-900">
    <main class="max-w-6xl mx-auto p-4 space-y-6">
      <h1 class="text-2xl font-semibold">Admin Dashboard</h1>
      <section class="bg-white border rounded p-4">
        <h2 class="font-semibold mb-3">Products</h2>
        <div id="products" class="space-y-2"></div>
        <div class="mt-3 flex gap-2">
          <input id="p-name" class="border rounded px-2 py-1" placeholder="Name" />
          <input id="p-slug" class="border rounded px-2 py-1" placeholder="Slug" />
          <input id="p-price" type="number" step="0.01" class="border rounded px-2 py-1" placeholder="Price" />
          <input id="p-stock" type="number" class="border rounded px-2 py-1" placeholder="Stock" />
          <input id="p-category" type="number" class="border rounded px-2 py-1" placeholder="Category ID" />
          <button id="p-create" class="px-3 py-1 rounded bg-emerald-600 text-white">Add</button>
        </div>
      </section>
    </main>
    <script type="module">
      import { adminListProducts, adminCreateProduct, adminDeleteProduct } from './js/admin.js';

      const productsDiv = document.getElementById('products');
      const btn = document.getElementById('p-create');

      async function loadProducts() {
        const prods = await adminListProducts();
        productsDiv.innerHTML = '';
        prods.forEach((p) => {
          const row = document.createElement('div');
          row.className = 'flex items-center justify-between border rounded px-3 py-2';
          row.innerHTML = `
            <div>${p.name} - $${p.price} (Stock: ${p.stock})</div>
            <button class="del text-red-600">Delete</button>
          `;
          row.querySelector('.del').addEventListener('click', async () => {
            await adminDeleteProduct(p.id);
            await loadProducts();
          });
          productsDiv.appendChild(row);
        });
      }

      btn.addEventListener('click', async () => {
        const payload = {
          name: document.getElementById('p-name').value,
          slug: document.getElementById('p-slug').value,
          price: parseFloat(document.getElementById('p-price').value || '0'),
          stock: parseInt(document.getElementById('p-stock').value || '0', 10),
          category_id: parseInt(document.getElementById('p-category').value || '1', 10),
        };
        await adminCreateProduct(payload);
        await loadProducts();
      });

      loadProducts();
    </script>
  </body>
  </html>


